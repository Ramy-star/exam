/**
 * @fileoverview Firestore Security Rules for GitGrind application.
 *
 * Core Philosophy:
 * This ruleset prioritizes user data protection and enforces a combination of
 * ownership-based and public-read access patterns. User-specific data is secured
 * under `/users/{userId}`, while content like lectures and questions are publicly
 * readable.  Write access to exam results is restricted to prevent unauthorized
 * modifications.
 *
 * Data Structure:
 * - /users/{userId}: Stores private user data (theme, lastLecture).
 * - /lectures/{lectureId}: Stores lecture content. Publicly readable.
 * - /mcqs/{mcqId}: Stores multiple-choice questions. Publicly readable.
 * - /writtenQuestions/{writtenQuestionId}: Stores written questions. Publicly readable.
 * - /examResults/{resultId}: Stores exam results. Publicly readable, write-protected.
 *
 * Key Security Decisions:
 * - Users can only read/write their own user documents.
 * - Lectures, MCQs and WrittenQuestions are publicly readable (get, list).
 * - ExamResults are publicly readable (get, list) but cannot be created, updated, or deleted by clients.
 * - Listing all users is disallowed.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Manages access to user-specific data.
     * @path /users/{userId}
     * @allow (create) User with ID 'user123' can create their own document.
     * @allow (get,update,delete) Authenticated user with ID 'user123' can access their own user document.
     * @deny (create,update,delete) Authenticated user with ID 'user456' cannot modify user document for 'user123'.
     * @principle Enforces document ownership for writes.
     */
    match /users/{userId} {
      function isOwner(userId) {
        return request.auth != null && request.auth.uid == userId;
      }

      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isOwner(userId);
      allow update: if isOwner(userId);
      allow delete: if isOwner(userId);
    }

    /**
     * @description Allows public read access to lecture content.
     * @path /lectures/{lectureId}
     * @allow (get, list) Any user can read lecture data.
     * @deny (create,update,delete) No user can create, update, or delete lecture data via client.
     * @principle Allows public read access while restricting write access.
     */
    match /lectures/{lectureId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows public read access to multiple-choice questions.
     * @path /mcqs/{mcqId}
     * @allow (get, list) Any user can read MCQ data.
     * @deny (create,update,delete) No user can create, update, or delete MCQ data via client.
     * @principle Allows public read access while restricting write access.
     */
    match /mcqs/{mcqId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows public read access to written questions.
     * @path /writtenQuestions/{writtenQuestionId}
     * @allow (get, list) Any user can read written question data.
     * @deny (create,update,delete) No user can create, update, or delete written question data via client.
     * @principle Allows public read access while restricting write access.
     */
    match /writtenQuestions/{writtenQuestionId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows public read access to exam results but restricts write access.
     * @path /examResults/{resultId}
     * @allow (get, list) Any user can read exam result data.
     * @deny (create,update,delete) No user can create, update, or delete exam result data via client.
     * @principle Allows public read access while restricting write access for data integrity.
     */
    match /examResults/{resultId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }
  }
}